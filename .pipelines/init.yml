parameters:
  # Configuration: Release
  Verbosity: Normal
  DotNetVersion: "8.0.303"
  CakeVersion: "1.1.0"
steps:
  - task: DownloadBuildArtifacts@0
    displayName: "Download GitVersion Variables"
    inputs:
      specificBuildWithTriggering: true
      downloadType: single
      artifactName: gitversion
      pipelineId: GitVersion
      targetPath: "$(Build.ArtifactStagingDirectory)/gitversion/"
  - task: RocketSurgeonsGuild.variable-tools.DeserializeVariables.DeserializeVariables@1
    displayName: "Deserialize GitVersion"
    inputs:
      jsonfiles: $(Build.ArtifactStagingDirectory)/gitversion/**/gitversion.json
  - task: UseDotNet@2
    displayName: Install dotnet $(DotNetVersion)
    inputs:
      packageType: "sdk"
      version: ${{ parameters.DotNetVersion }}
  - task: DotNetCoreCLI@2
    displayName: "dotnet install cake"
    inputs:
      command: custom
      custom: tool
      arguments: "install -g Cake.Tool --version $(CakeVersion)"
      workingDirectory: "$(Build.ArtifactStagingDirectory)"
    env:
      CakeVersion: ${{ parameters.CakeVersion }}
